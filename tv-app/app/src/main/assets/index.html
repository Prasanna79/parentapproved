<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParentApproved.tv</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.svg">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <div id="offline-banner" class="offline-banner hidden">
            <span>TV is not connected. Make sure your TV is powered on, connected to WiFi, and Remote Access is enabled in the TV app Settings.</span>
        </div>

        <div id="version-banner" class="version-banner hidden">
            <span>Your TV app needs updating. Please update ParentApproved on your TV.</span>
        </div>

        <div id="auth-screen">
            <h1><svg class="logo" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="24" fill="#22A559"/><path d="M20 33.4L12 25.4L14.8 22.6L20 27.8L33.2 14.6L36 17.4Z" fill="#fff"/></svg> ParentApproved.tv</h1>
            <p>Enter the PIN shown on your TV</p>
            <form id="pin-form">
                <input type="text" id="pin-input" maxlength="6" pattern="[0-9]{6}" placeholder="000000" inputmode="numeric" autocomplete="off">
                <button type="submit">Connect</button>
            </form>
            <p id="auth-error" class="error hidden"></p>
        </div>

        <div id="dashboard" class="hidden">
            <header>
                <h1><svg class="logo" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="24" fill="#22A559"/><path d="M20 33.4L12 25.4L14.8 22.6L20 27.8L33.2 14.6L36 17.4Z" fill="#fff"/></svg> ParentApproved.tv</h1>
            </header>

            <div id="homescreen-banner" class="homescreen-banner hidden">
                <span id="homescreen-text">Add ParentApproved to your home screen for quick access.</span>
                <div class="homescreen-actions">
                    <button id="homescreen-add-btn" class="homescreen-btn">Add</button>
                    <button id="homescreen-dismiss-btn" class="homescreen-dismiss">&times;</button>
                </div>
            </div>

            <div id="now-playing" class="now-playing-card hidden">
                <div class="np-header">
                    <span class="badge">Now Playing</span>
                    <span id="np-playlist-title" class="np-playlist"></span>
                </div>
                <img id="np-thumbnail" class="np-thumbnail" src="" alt="">
                <div id="np-title" class="np-title"></div>
                <div class="np-progress-container">
                    <div class="np-progress-bar">
                        <div id="np-progress-fill" class="np-progress-fill"></div>
                    </div>
                    <div class="np-time">
                        <span id="np-elapsed">0:00</span>
                        <span id="np-duration">0:00</span>
                    </div>
                </div>
                <div class="np-controls">
                    <button id="np-stop-btn" class="np-btn np-btn-stop">Stop</button>
                    <button id="np-pause-btn" class="np-btn np-btn-pause">Pause</button>
                    <button id="np-next-btn" class="np-btn np-btn-next">Next</button>
                </div>
            </div>

            <section id="screen-time-section">
                <h2>Screen Time</h2>
                <div id="screen-time-card" class="screen-time-card">
                    <div class="st-status-row">
                        <span id="st-status-badge" class="badge st-badge-allowed">Allowed</span>
                        <span id="st-lock-reason" class="st-lock-reason hidden"></span>
                    </div>

                    <div class="st-usage-row">
                        <div class="st-usage-bar-container">
                            <div id="st-usage-bar" class="st-usage-bar" style="width: 0%"></div>
                        </div>
                        <span id="st-usage-label" class="st-usage-label">0m / No limit</span>
                    </div>

                    <div id="st-time-request" class="st-time-request hidden">
                        Your child is requesting more time.
                        <div class="st-request-actions">
                            <button onclick="grantBonusTime(15)" class="st-bonus-btn">+15 min</button>
                            <button onclick="grantBonusTime(30)" class="st-bonus-btn">+30 min</button>
                        </div>
                    </div>

                    <div class="st-controls">
                        <button id="st-lock-btn" onclick="toggleLock()">Lock TV</button>
                        <button id="st-bonus-15" class="st-bonus-btn" onclick="grantBonusTime(15)">+15 min</button>
                        <button id="st-bonus-30" class="st-bonus-btn" onclick="grantBonusTime(30)">+30 min</button>
                        <button id="st-edit-btn" class="st-edit-btn" onclick="openEditLimits()">Edit Limits</button>
                    </div>
                </div>

                <!-- Edit Limits Modal -->
                <div id="edit-limits-modal" class="modal-overlay hidden">
                    <div class="modal-content">
                        <h3>Edit Time Limits</h3>

                        <div class="modal-field">
                            <label>
                                <input type="checkbox" id="edit-limit-enabled"> Daily limit
                            </label>
                            <div id="edit-limit-input-row" class="modal-input-row hidden">
                                <input type="number" id="edit-limit-minutes" min="1" max="480" value="120" class="modal-number-input">
                                <span>minutes</span>
                            </div>
                        </div>

                        <div class="modal-field">
                            <label>
                                <input type="checkbox" id="edit-bedtime-enabled"> Bedtime
                            </label>
                            <div id="edit-bedtime-input-row" class="modal-input-row hidden">
                                <input type="time" id="edit-bedtime-start" value="20:30" class="modal-time-input">
                                <span>to</span>
                                <input type="time" id="edit-bedtime-end" value="07:00" class="modal-time-input">
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button onclick="saveLimits()" class="modal-save-btn">Save</button>
                            <button onclick="closeEditLimits()" class="modal-cancel-btn">Cancel</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="playlists-section">
                <h2>Content Sources</h2>
                <form id="playlist-form">
                    <input type="url" id="playlist-url" placeholder="Paste any YouTube URL (video, playlist, or channel)" required>
                    <button type="submit">Add</button>
                </form>
                <p id="playlist-error" class="error hidden"></p>
                <ul id="playlist-list"></ul>
            </section>

            <section id="stats-section">
                <h2>Today's Activity</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="stat-videos">0</span>
                        <span class="stat-label">Videos</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="stat-time">0m</span>
                        <span class="stat-label">Watch Time</span>
                    </div>
                </div>
            </section>

            <section id="recent-section">
                <h2>Recent Activity</h2>
                <ul id="recent-list"></ul>
            </section>

            <section id="crash-section" class="hidden">
                <h2>Last Crash</h2>
                <pre id="crash-log" class="crash-log"></pre>
                <button id="copy-crash" class="btn-small">Copy to clipboard</button>
            </section>

            <footer class="dashboard-footer">
                <p class="version-line">
                    <span id="footer-version"></span>
                    <span id="update-badge" class="update-badge hidden">Update available</span>
                </p>
                <p><a id="feedback-link" href="mailto:hello@parentapproved.tv">Report a problem</a></p>
                <p class="charityware-text">ParentApproved.tv is free, forever. <a href="https://mettavipassana.org/donate" target="_blank" rel="noopener">Support loving-kindness meditation</a></p>
            </footer>

            <footer id="local-notice" class="local-notice">
                <p>This dashboard is local-only (same WiFi). To access from anywhere, enable Remote Access in the TV app Settings.</p>
            </footer>
        </div>
    </div>
    <script src="app.js"></script>
</body>
</html>
